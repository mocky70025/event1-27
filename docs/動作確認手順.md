# 動作確認手順

## 確認対象機能

1. **CSVダウンロード機能** - 主催者が申し込み情報をCSV形式でダウンロード
2. **イベント申し込み時の確認ダイアログ** - 出店者がイベントに申し込む際の確認
3. **イベント承認/却下時の確認ダイアログ** - 主催者が申し込みを承認/却下する際の確認

---

## 事前準備

### 1. 主催者アカウントの準備

1. 主催者アプリ（`organizer`）にアクセス
2. 新規登録またはログイン
   - メールアドレス/パスワード認証
   - Google認証
   - LINE認証（LIFF環境の場合）
3. 主催者情報を登録
   - 会社名
   - 氏名
   - 性別
   - 年齢
   - 電話番号
   - メールアドレス
   - 利用規約への同意

### 2. 出店者アカウントの準備

1. 出店者アプリ（`store`）にアクセス
2. 新規登録またはログイン
   - メールアドレス/パスワード認証
   - Google認証
   - LINE認証（LIFF環境の場合）
3. 出店者情報を登録
   - 氏名
   - 性別
   - 年齢
   - 電話番号
   - メールアドレス
   - ジャンル
   - より詳しいジャンル
   - 営業許可証（画像）
   - 車検証（画像）
   - 自動車検査証（画像）
   - PL保険登録証（画像）
   - 火器類配置図（画像）
   - 利用規約への同意

### 3. イベントの作成

1. 主催者アカウントでログイン
2. 「イベントを作成」をクリック
3. イベント情報を入力
   - イベント名
   - イベント名（ふりがな）
   - ジャンル
   - 開催期間
   - 表示期間
   - 開催時間
   - リード文
   - イベント説明
   - 会場名
   - 会場住所
   - メイン画像
   - 追加画像（任意）
   - ホームページURL（任意）
   - 申し込み締切日（任意）
4. 「イベントを作成」をクリック

---

## 機能1: イベント申し込み時の確認ダイアログ

### 確認手順

1. **出店者アカウントでログイン**
   - 出店者アプリ（`store`）にアクセス
   - ログイン済みであることを確認

2. **イベント一覧を表示**
   - トップページでイベント一覧が表示されることを確認

3. **イベント詳細を表示**
   - 任意のイベントカードをクリック
   - イベント詳細が表示されることを確認

4. **「申し込む」ボタンをクリック**
   - イベント詳細画面の「申し込む」ボタンをクリック

5. **確認ダイアログの確認**
   - ✅ 確認ダイアログが表示されること
   - ✅ ダイアログに「『[イベント名]』に申し込むか？」と表示されること
   - ✅ 「申し込み後、主催者による承認が必要です。」という説明が表示されること

6. **「キャンセル」をクリック**
   - ✅ ダイアログが閉じること
   - ✅ 申し込みが完了しないこと
   - ✅ 画面が元の状態に戻ること

7. **再度「申し込む」ボタンをクリック**
   - 確認ダイアログが再度表示されることを確認

8. **「OK」をクリック**
   - ✅ 申し込みが完了すること
   - ✅ 成功メッセージが表示されること（または画面が更新されること）
   - ✅ 申し込みステータスが「審査中」になること

### 期待される結果

- 確認ダイアログが正しく表示される
- 「キャンセル」で申し込みがキャンセルされる
- 「OK」で申し込みが完了する
- エラーが発生しない

---

## 機能2: イベント承認/却下時の確認ダイアログ

### 確認手順

1. **主催者アカウントでログイン**
   - 主催者アプリ（`organizer`）にアクセス
   - ログイン済みであることを確認

2. **イベント管理画面を表示**
   - 作成したイベントを選択
   - 「申し込みを確認」または「申し込み一覧」をクリック

3. **申し込み一覧を確認**
   - 出店者の申し込みが「審査中」で表示されることを確認

4. **「承認」ボタンをクリック**
   - 申し込み一覧の「承認」ボタンをクリック

5. **確認ダイアログの確認（承認）**
   - ✅ 確認ダイアログが表示されること
   - ✅ ダイアログに「この申し込みを承認しますか？」と表示されること
   - ✅ 「承認すると、出店者に通知が送信されます。」という説明が表示されること

6. **「キャンセル」をクリック**
   - ✅ ダイアログが閉じること
   - ✅ 承認が完了しないこと
   - ✅ 申し込みステータスが「審査中」のままであること

7. **再度「承認」ボタンをクリック**
   - 確認ダイアログが再度表示されることを確認

8. **「OK」をクリック**
   - ✅ 承認が完了すること
   - ✅ 申し込みステータスが「承認済み」に変わること
   - ✅ 出店者に通知が送信されること（通知機能が有効な場合）

9. **「却下」ボタンの確認**
   - 別の申し込み（またはテスト用に再度申し込む）で「却下」ボタンをクリック
   - ✅ 確認ダイアログが表示されること
   - ✅ ダイアログに「この申し込みを却下しますか？」と表示されること
   - ✅ 「却下すると、出店者に通知が送信されます。」という説明が表示されること

10. **「OK」をクリック**
    - ✅ 却下が完了すること
    - ✅ 申し込みステータスが「却下」に変わること
    - ✅ 出店者に通知が送信されること（通知機能が有効な場合）

### 期待される結果

- 承認/却下の確認ダイアログが正しく表示される
- 「キャンセル」で処理がキャンセルされる
- 「OK」で処理が完了する
- 申し込みステータスが正しく更新される
- エラーが発生しない

---

## 機能3: CSVダウンロード機能

### 確認手順

1. **主催者アカウントでログイン**
   - 主催者アプリ（`organizer`）にアクセス
   - ログイン済みであることを確認

2. **イベント管理画面を表示**
   - 作成したイベントを選択
   - 「申し込みを確認」または「申し込み一覧」をクリック

3. **申し込みが存在することを確認**
   - 少なくとも1件の申し込み（承認済みまたは審査中）が存在することを確認
   - 複数の申し込みがある場合は、より正確なテストが可能

4. **「申し込みを締め切る」ボタンを確認**
   - 申し込み一覧画面に「申し込みを締め切る」ボタンが表示されることを確認

5. **「申し込みを締め切る」ボタンをクリック**
   - 「申し込みを締め切る」ボタンをクリック

6. **確認ダイアログの確認**
   - ✅ 確認ダイアログが表示されること
   - ✅ ダイアログに「申し込みを締め切りますか？」と表示されること
   - ✅ 「締め切ると、出店者情報をCSV形式でダウンロードできるようになります。」という説明が表示されること

7. **「キャンセル」をクリック**
   - ✅ ダイアログが閉じること
   - ✅ 締め切りが完了しないこと

8. **再度「申し込みを締め切る」ボタンをクリック**
   - 確認ダイアログが再度表示されることを確認

9. **「OK」をクリック**
   - ✅ 締め切り処理が開始されること
   - ✅ 「処理中...」などの表示がされること（任意）

10. **CSVファイルのダウンロード確認**
    - ✅ 自動的にCSVファイルがダウンロードされること
    - ✅ ファイル名が「[イベント名]_[日付].csv」の形式であること
    - ✅ 成功メッセージが表示されること
      - 「申し込みを締め切りました。」
      - 「出店者数: [人数]名」
      - 「CSVファイルをダウンロードしました。」

11. **CSVファイルの内容確認**
    - ダウンロードしたCSVファイルを開く（Excel、Googleスプレッドシート、テキストエディタなど）
    - ✅ 以下の列が含まれていること：
      - 申し込みID
      - 出店者ID
      - 出店者名
      - 性別
      - 年齢
      - 電話番号
      - メールアドレス
      - ジャンルカテゴリ
      - ジャンル自由回答
      - 営業許可証画像URL
      - 車検証画像URL
      - 自動車検査証画像URL
      - PL保険画像URL
      - 火器類配置図画像URL
      - 申し込みステータス
      - 申し込み日時
      - 登録日時
    - ✅ すべての申し込みデータが含まれていること
    - ✅ 日本語が正しく表示されること（UTF-8 BOM付き）
    - ✅ データが正しく記載されていること

12. **締め切り後の動作確認**
    - ✅ 申し込み一覧画面に「CSV形式でダウンロード」ボタンが表示されること
    - ✅ 「申し込みを締め切る」ボタンが非表示になること（または無効化されること）

13. **締め切り後のCSVダウンロード確認**
    - 「CSV形式でダウンロード」ボタンをクリック
    - ✅ CSVファイルが再度ダウンロードされること
    - ✅ ファイル内容が正しいこと

### 期待される結果

- 確認ダイアログが正しく表示される
- 「OK」でCSVファイルがダウンロードされる
- CSVファイルにすべての申し込み情報が含まれている
- 日本語が正しく表示される
- エラーが発生しない

---

## トラブルシューティング

### CSVファイルがダウンロードされない場合

1. ブラウザのダウンロード設定を確認
2. ブラウザのコンソール（F12）でエラーを確認
3. ネットワークタブでAPIリクエストのレスポンスを確認

### 確認ダイアログが表示されない場合

1. ブラウザのポップアップブロック設定を確認
2. ブラウザのコンソール（F12）でエラーを確認
3. JavaScriptが有効になっているか確認

### 申し込みが完了しない場合

1. ブラウザのコンソール（F12）でエラーを確認
2. ネットワークタブでAPIリクエストのエラーを確認
3. データベースの接続を確認

---

## 確認チェックリスト

### 機能1: イベント申し込み時の確認ダイアログ
- [ ] 確認ダイアログが表示される
- [ ] 「キャンセル」で申し込みがキャンセルされる
- [ ] 「OK」で申し込みが完了する
- [ ] エラーが発生しない

### 機能2: イベント承認/却下時の確認ダイアログ
- [ ] 承認の確認ダイアログが表示される
- [ ] 却下の確認ダイアログが表示される
- [ ] 「キャンセル」で処理がキャンセルされる
- [ ] 「OK」で処理が完了する
- [ ] 申し込みステータスが正しく更新される
- [ ] エラーが発生しない

### 機能3: CSVダウンロード機能
- [ ] 確認ダイアログが表示される
- [ ] CSVファイルがダウンロードされる
- [ ] ファイル名が正しい
- [ ] CSVファイルにすべての列が含まれている
- [ ] CSVファイルにすべての申し込みデータが含まれている
- [ ] 日本語が正しく表示される
- [ ] エラーが発生しない

---

## 注意事項

- テスト環境と本番環境で動作が異なる場合があります
- ブラウザのキャッシュをクリアしてから確認することを推奨します
- 複数のブラウザで確認することを推奨します（Chrome、Firefox、Safari、Edgeなど）
- モバイルとデスクトップの両方で確認することを推奨します

